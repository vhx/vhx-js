{"version":3,"file":"index.js","sources":["../lib/utils.js","../lib/urlHelpers.js","../lib/config.js","../lib/resource.js","../lib/resources/collections.js","../lib/resources/videos.js","../lib/resources/customers.js","../lib/resources/browse.js","../lib/vhx.js","../lib/resources/products.js","../lib/resources/analytics.js"],"sourcesContent":["export function getMethod(params) {\n  return isObject(params) && params.method ?\n          params.method :\n          params;\n}\n\nexport function isHref(params) {\n  return params && isNaN(parseInt(params, 10));\n}\n\nexport function isObject(obj) {\n  const type = typeof obj;\n  return type === 'function' || type === 'object' && !!obj;\n}\n\nexport function isFunction(obj) {\n  return obj && !!(obj && obj.constructor && obj.call && obj.apply);\n}","import {\n  isHref,\n  isFunction,\n  isObject,\n} from './utils';\n\nexport function generateUrl(params, resource, options) {\n  if (resource.path === 'products') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'videos') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'collections') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'customers') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'browse') {\n    return handleBrowseEndpoint(params, resource);\n  }\n\n  return returnDefaultHref(resource);\n};\n\nconst handleBrowseEndpoint = (params, resource) => {\n\n  if (isObject(params)) {\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}`;\n  }\n\n  return `${resource._api.protocol}${resource._api.host}/${resource.path}?product=${params}`;\n};\n\nconst createUrlWithCustomEndpoints = (params, resource, options) => {\n  if (options && options.scope && options.scope !== 'items') {\n    if (params && isHref(params)) {\n      return `${params}/${options.scope}`;\n    }\n\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}/${options.scope}`;\n  }\n\n  if (options && options.scope && options.scope === 'items') {\n    if (params && isHref(params)) {\n      return params;\n    }\n\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}/${options.scope}`;\n  }\n\n  if (params && isHref(params) && !isFunction(params) && !isObject(params)) {\n    return params;\n  }\n\n  if (params && !isFunction(params) && !isObject(params)) {\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}`;\n  }\n\n  return returnDefaultHref(resource);\n}\n\nconst returnDefaultHref = (resource) => {\n  return `${resource._api.protocol}${resource._api.host}/${resource.path}`;\n}\n\n\n\n","const ApiConfig = {\n  HOST: 'api.vhx.tv',\n  PROTOCOL: 'https://',\n  TIMEOUT: '30000',\n  NODE: process.env.NODE_BUILD,\n  TOKEN_EXPIRES_IN: '1800000'\n};\n\nexport default ApiConfig;\n","import request from 'superagent';\nimport { generateUrl } from './urlHelpers';\nimport {\n  getMethod,\n  isObject,\n  isFunction,\n} from './utils';\n\nclass Resource {\n  constructor(api, path, methods, isToken) {\n    this._api    = api;\n    this.methods = methods;\n    this.path    = path;\n\n    this.init();\n  }\n\n  init() {\n    this.methods.forEach((item) => {\n      const method = getMethod(item);\n      const params = {\n        http_method: 'get', // superagent reads 'get' not 'GET'\n        client_method: method\n      };\n\n      if (method.match(/update|addItem/)) {\n        params.http_method = 'put';\n      }\n\n      if (method.match(/create/)) {\n        params.http_method = 'post';\n      }\n\n      if (method.match(/removeItem/)) {\n        params.http_method = 'delete';\n      }\n\n      if (method.match(/files|items|watching|watchlist/)) {\n        params.scope = item;\n      }\n\n      if (method.match(/addItem|removeItem/)) {\n        params.scope = 'items';\n      }\n\n      this[method] = (identifier, options) => {\n        params.url = generateUrl(identifier, this, params);\n\n        /**\n         * The param types being passed into the client library can vary based on the endpoint.\n         * For example, the products/all endpoint, can take an optional object as it's first param:\n         * vhx.products.all({per_page: 10})\n         *\n         * But we also want to make sure we can handle other product endpoints such as:\n         * vhx.products.retrieve(14440);\n         *\n         * or\n         *\n         * vhx.products.retrieve(14440, { per_page: 10 });\n         *\n         * We need to check if the initial param is an object or not, so that we can place\n         * it into the correct params variable.\n        **/\n        if (isObject(identifier)) {\n          params.options = identifier;\n        } else {\n          params.options = options;\n        }\n\n        return this.createRequestParams(params);\n      };\n    });\n  }\n\n  getParams(client_method, url, options, scope, type) {\n    const params = {\n      timeout : this._api.timeout,\n      method  : client_method,\n      url     : url,\n    };\n\n    if (isObject(options)) {\n      params.qs = options || null;\n    }\n\n    if (this._api.auth) {\n      params.headers = {\n        'Authorization': this._api.auth\n      };\n    }\n\n    if (this._api.internal) {\n      params.headers = {\n        'Authorization': 'Bearer ' + this._api.token\n      }\n    }\n\n    return params;\n  }\n\n  createRequestParams(args) {\n    const params = this.getParams(args.client_method, args.url, args.options, args.scope, args.read_only);\n\n    return this.ajaxRequest(args, params);\n  }\n\n  ajaxRequest(args, params) {\n    const promise = new Promise((resolve, reject) => {\n      const req = () => {\n        request[args.http_method](params.url)\n          .withCredentials()\n          .set(params.headers || {})\n          .set('Content-Type', 'application/json')\n          .query(params.qs)\n          .then((response) => {\n\n            // TODO: rebuild built-in pagination methods\n            // if (args.body.count && args.body.count < args.body.total) {\n            //   response = new paginate(this, args).get();\n            // }\n\n            if (response.ok) {\n              resolve(response.body)\n            }\n\n            reject(response);\n          })\n          .catch((err) => reject(err));\n      }\n\n      return req();\n    });\n\n    return promise;\n  }\n};\n\nexport default Resource;\n","import Resource from '../resource';\n\nclass Collection extends Resource {\n  constructor(api) {\n    super(\n      api,\n      'collections',\n      process.env.NODE_BUILD ?\n        [ 'all', 'retrieve', 'items', 'update', 'create', 'addItem', 'removeItem' ] :\n        [ 'all', 'retrieve', 'items' ]\n    );\n  }\n};\n\nexport default Collection;\n","import Resource from '../resource';\n\nclass Video extends Resource {\n  constructor(api) {\n    super(\n      api,\n      'videos',\n      process.env.NODE_BUILD ?\n        ['all', 'retrieve', 'files', 'create', 'update'] :\n        ['all', 'retrieve', 'files']\n    );\n  }\n};\n\nexport default Video;\n","import Resource from '../resource';\n\nclass Customer extends Resource {\n  constructor(api) {\n    super(\n      api,\n      'customers',\n      process.env.NODE_BUILD ?\n        ['retrieve', 'all', 'watching', 'watchlist', 'addProduct', 'removeProduct', 'update' ] :\n        ['retrieve', 'all', 'watching', 'watchlist']\n    );\n  }\n};\n\nexport default Customer;\n","import Resource from '../resource';\n\nclass Browse extends Resource {\n  constructor(api) {\n    super(api, 'browse', ['list']);\n  }\n};\n\nexport default Browse;\n","import ApiConfig from './config';\nimport Collection from './resources/collections';\nimport Video from './resources/videos';\nimport Customer from './resources/customers';\nimport Browse from './resources/browse';\nimport Product from './resources/products';\nimport Analytics from './resources/analytics';\n\nconst resources = {\n  products    : Product,\n  browse      : Browse,\n  videos      : Video,\n  collections : Collection,\n  customers   : Customer,\n  analytics   : Analytics\n};\n\nif (typeof btoa === 'undefined') {\n  global.btoa = function(str) {\n    return new Buffer(str).toString('base64');\n  }\n}\n\nclass VhxApi {\n  constructor(key, opts={}) {\n    this.api = opts.internal ? this.setToken(key, opts) : this.setApi(key, opts);\n\n    this.prepareResources();\n  }\n\n  setApi(key, opts = {}) {\n    return {\n      auth: 'Basic ' + btoa(key),\n      host: opts.host || ApiConfig.HOST,\n      protocol: opts.protocol || ApiConfig.PROTOCOL,\n      timeout: ApiConfig.TIMEOUT,\n      token_expiration: null\n    };\n  }\n\n  setToken(key, opts = {}) {\n    return {\n      token: key,\n      host: opts.host || ApiConfig.HOST,\n      protocol: opts.protocol || ApiConfig.PROTOCOL,\n      timeout: opts.timeout || ApiConfig.TIMEOUT,\n      token_expiration: opts.TOKEN_EXPIRES_IN || ApiConfig.TOKEN_EXPIRES_IN,\n      internal: true\n    };\n  }\n\n  prepareResources() {\n    for (const name in resources) {\n      this[name[0].toLowerCase() + name.substring(1)] = new resources[name](this.api);\n    }\n  }\n}\n\nexport default VhxApi;\n","import Resource from '../resource';\n\nclass Product extends Resource {\n  constructor(api) {\n    super(api, 'products', ['retrieve', 'all']);\n  }\n};\n\nexport default Product;\n","import Resource from '../resource';\n\nclass Analytics extends Resource {\n  constructor(api) {\n    super(api, 'analytics', ['retrieve']);\n  }\n};\n\nexport default Analytics;\n"],"names":["getMethod","params","isObject","method","isHref","isNaN","parseInt","obj","const","type","isFunction","constructor","call","apply","generateUrl","resource","options","path","createUrlWithCustomEndpoints","handleBrowseEndpoint","returnDefaultHref","ApiConfig","HOST","PROTOCOL","TIMEOUT","NODE","TOKEN_EXPIRES_IN","_api","scope","Resource","api","methods","isToken","this","init","forEach","item","http_method","client_method","match","this$1","identifier","url","createRequestParams","getParams","timeout","qs","auth","headers","Authorization","internal","token","args","read_only","ajaxRequest","Promise","resolve","reject","request","withCredentials","set","query","then","response","ok","body","catch","err","Collection","super","Video","Customer","Browse","resources","products","browse","videos","collections","customers","analytics","btoa","global","str","Buffer","toString","VhxApi","key","opts","setToken","setApi","prepareResources","host","protocol","token_expiration","name","toLowerCase","substring"],"mappings":"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"}