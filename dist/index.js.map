{"version":3,"file":"index.js","sources":["../lib/config.js","../lib/utils.js","../lib/urlHelpers.js","../lib/resource.js","../lib/resources/collections.js","../lib/resources/videos.js","../lib/resources/customers.js","../lib/resources/browse.js","../lib/vhx.js","../lib/resources/products.js","../lib/resources/analytics.js"],"sourcesContent":["const ApiConfig = {\n  HOST: 'api.vhx.tv',\n  PROTOCOL: 'https://',\n  TIMEOUT: '30000',\n  NODE: process.env.NODE_BUILD,\n  TOKEN_EXPIRES_IN: '1800000'\n};\n\nexport default ApiConfig;\n","export function getMethod(params) {\n  return isObject(params) && params.method ?\n          params.method :\n          params;\n}\n\nexport function isHref(params) {\n  return params && isNaN(parseInt(params, 10));\n}\n\nexport function isObject(obj) {\n  const type = typeof obj;\n  return type === 'function' || type === 'object' && !!obj;\n}\n\nexport function isFunction(obj) {\n  return obj && !!(obj && obj.constructor && obj.call && obj.apply);\n}","import {\n  isHref,\n  isFunction,\n  isObject,\n} from './utils';\n\nexport function generateUrl(params, resource, options) {\n  if (resource.path === 'products') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'videos') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'collections') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'customers') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'browse') {\n    return handleBrowseEndpoint(params, resource);\n  }\n\n  return returnDefaultHref(resource);\n};\n\nconst handleBrowseEndpoint = (params, resource) => {\n\n  if (isObject(params)) {\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}`;\n  }\n\n  return `${resource._api.protocol}${resource._api.host}/${resource.path}?product=${params}`;\n};\n\nconst createUrlWithCustomEndpoints = (params, resource, options) => {\n  if (options && options.scope && options.scope !== 'items') {\n    if (params && isHref(params)) {\n      return `${params}/${options.scope}`;\n    }\n\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}/${options.scope}`;\n  }\n\n  if (options && options.scope && options.scope === 'items') {\n    if (params && isHref(params)) {\n      return params;\n    }\n\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}/${options.scope}`;\n  }\n\n  if (params && isHref(params) && !isFunction(params) && !isObject(params)) {\n    return params;\n  }\n\n  if (params && !isFunction(params) && !isObject(params)) {\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}`;\n  }\n\n  return returnDefaultHref(resource);\n}\n\nconst returnDefaultHref = (resource) => {\n  return `${resource._api.protocol}${resource._api.host}/${resource.path}`;\n}\n\n\n\n","import { generateUrl } from './urlHelpers';\nimport {\n  getMethod,\n  isObject,\n  isFunction,\n} from './utils';\n\nclass Resource {\n  constructor(api, path, methods, isToken) {\n    this._api    = api;\n    this.methods = methods;\n    this.path    = path;\n\n    this.init();\n  }\n\n  init() {\n    this.methods.forEach((item) => {\n      const method = getMethod(item);\n      const params = {\n        http_method: 'get', // superagent reads 'get' not 'GET'\n        client_method: method\n      };\n\n      if (method.match(/update|addItem|addProduct/)) {\n        params.http_method = 'put';\n      }\n\n      if (method.match(/create/)) {\n        params.http_method = 'post';\n      }\n\n      if (method.match(/removeItem|removeProduct/)) {\n        params.http_method = 'delete';\n      }\n\n      if (method.match(/files|items|watching|watchlist/)) {\n        params.scope = item;\n      }\n\n      if (method.match(/addItem|removeItem/)) {\n        params.scope = 'items';\n      }\n\n      this[method] = (identifier, options) => {\n        params.url = generateUrl(identifier, this, params);\n\n        /**\n         * The param types being passed into the client library can vary based on the endpoint.\n         * For example, the products/all endpoint, can take an optional object as it's first param:\n         * vhx.products.all({per_page: 10})\n         *\n         * But we also want to make sure we can handle other product endpoints such as:\n         * vhx.products.retrieve(14440);\n         *\n         * or\n         *\n         * vhx.products.retrieve(14440, { per_page: 10 });\n         *\n         * We need to check if the initial param is an object or not, so that we can place\n         * it into the correct params variable.\n        **/\n        if (isObject(identifier)) {\n          params.options = identifier;\n        } else {\n          params.options = options;\n        }\n\n        return this.createRequestParams(params);\n      };\n    });\n  }\n\n  getParams(client_method, url, options, scope, type) {\n    const params = {\n      timeout : this._api.timeout,\n      method  : client_method,\n      url     : url,\n    };\n\n    if (isObject(options)) {\n      params.qs = options || null;\n    }\n\n    if (this._api.auth) {\n      params.headers = {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n        'Authorization': this._api.auth\n      };\n    }\n\n    if (this._api.internal) {\n      params.headers = {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n        'Authorization': 'Bearer ' + this._api.token\n      }\n    }\n\n    return params;\n  }\n\n  createRequestParams(args) {\n    const params = this.getParams(args.client_method, args.url, args.options, args.scope, args.read_only);\n\n    return this.fetchRequest(args, params);\n  }\n\n  fetchRequest(args, params) {\n    let url = new URL(params.url);\n\n    if (args.options) {\n      Object.keys(args.options).forEach(key => {\n        if (args.options[key]) {\n          url.searchParams.append(key, args.options[key])\n        }\n      });\n    }\n\n    return fetch(url.href, {\n      method: args.http_method,\n      headers: params.headers,\n      credentials: 'include',\n    })\n    .then(res => {\n      if (res.ok) {\n        if (res.status === 204) {\n          return {};\n        }\n\n        return res.json();\n      }\n\n      return Promise.reject({ status: res.status, statusText: res.statusText });\n    });\n  }\n};\n\nexport default Resource;\n","import Resource from '../resource';\n\nclass Collection extends Resource {\n  constructor(api) {\n    super(\n      api,\n      'collections',\n      process.env.NODE_BUILD ?\n        [ 'all', 'retrieve', 'items', 'update', 'create', 'addItem', 'removeItem' ] :\n        [ 'all', 'retrieve', 'items' ]\n    );\n  }\n};\n\nexport default Collection;\n","import Resource from '../resource';\n\nclass Video extends Resource {\n  constructor(api) {\n    super(\n      api,\n      'videos',\n      process.env.NODE_BUILD ?\n        ['all', 'retrieve', 'files', 'create', 'update'] :\n        ['all', 'retrieve', 'files']\n    );\n  }\n};\n\nexport default Video;\n","import Resource from '../resource';\n\nclass Customer extends Resource {\n  constructor(api) {\n    super(\n      api,\n      'customers',\n      process.env.NODE_BUILD ?\n        ['retrieve', 'all', 'watching', 'watchlist', 'addProduct', 'removeProduct', 'update' ] :\n        ['retrieve', 'all', 'watching', 'watchlist']\n    );\n  }\n};\n\nexport default Customer;\n","import Resource from '../resource';\n\nclass Browse extends Resource {\n  constructor(api) {\n    super(api, 'browse', ['list']);\n  }\n};\n\nexport default Browse;\n","import ApiConfig from './config';\nimport Collection from './resources/collections';\nimport Video from './resources/videos';\nimport Customer from './resources/customers';\nimport Browse from './resources/browse';\nimport Product from './resources/products';\nimport Analytics from './resources/analytics';\n\nconst resources = {\n  products    : Product,\n  browse      : Browse,\n  videos      : Video,\n  collections : Collection,\n  customers   : Customer,\n  analytics   : Analytics\n};\n\nif (typeof btoa === 'undefined') {\n  global.btoa = function(str) {\n    return new Buffer(str).toString('base64');\n  }\n}\n\nclass VhxApi {\n  constructor(key, opts={}) {\n    this.api = opts.internal ? this.setToken(key, opts) : this.setApi(key, opts);\n\n    this.prepareResources();\n  }\n\n  setApi(key, opts = {}) {\n    return {\n      auth: 'Basic ' + btoa(key),\n      host: opts.host || ApiConfig.HOST,\n      protocol: opts.protocol || ApiConfig.PROTOCOL,\n      timeout: ApiConfig.TIMEOUT,\n      token_expiration: null\n    };\n  }\n\n  setToken(key, opts = {}) {\n    return {\n      token: key,\n      host: opts.host || ApiConfig.HOST,\n      protocol: opts.protocol || ApiConfig.PROTOCOL,\n      timeout: opts.timeout || ApiConfig.TIMEOUT,\n      token_expiration: opts.TOKEN_EXPIRES_IN || ApiConfig.TOKEN_EXPIRES_IN,\n      internal: true\n    };\n  }\n\n  prepareResources() {\n    for (const name in resources) {\n      this[name[0].toLowerCase() + name.substring(1)] = new resources[name](this.api);\n    }\n  }\n}\n\nexport default VhxApi;\n","import Resource from '../resource';\n\nclass Product extends Resource {\n  constructor(api) {\n    super(api, 'products', ['retrieve', 'all']);\n  }\n};\n\nexport default Product;\n","import Resource from '../resource';\n\nclass Analytics extends Resource {\n  constructor(api) {\n    super(api, 'analytics', ['retrieve']);\n  }\n};\n\nexport default Analytics;\n"],"names":["const","ApiConfig","isHref","params","isNaN","parseInt","isObject","obj","type","isFunction","constructor","call","apply","generateUrl","resource","options","path","createUrlWithCustomEndpoints","_api","handleBrowseEndpoint","returnDefaultHref","scope","Resource","api","methods","isToken","this","init","forEach","item","method","http_method","client_method","match","this$1","identifier","url","createRequestParams","getParams","timeout","qs","auth","headers","Accept","Content-Type","Authorization","internal","token","args","read_only","fetchRequest","URL","Object","keys","key","searchParams","append","fetch","href","credentials","then","res","ok","status","json","Promise","reject","statusText","Collection","super","Video","Customer","Browse","resources","products","browse","videos","collections","customers","analytics","btoa","global","str","Buffer","toString","VhxApi","opts","setToken","setApi","prepareResources","host","protocol","token_expiration","TOKEN_EXPIRES_IN","name","toLowerCase","substring"],"mappings":"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"}